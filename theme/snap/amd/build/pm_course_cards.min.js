/**
 * This file is part of Moodle - http://moodle.org/
 *
 * Moodle is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Moodle is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @package
 * @copyright Copyright (c) 2016 Open LMS (https://www.openlms.net)
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_snap/pm_course_cards",["jquery","core/log","core/templates","theme_snap/pm_course_favorites","theme_snap/model_view","theme_snap/ajax_notification","theme_snap/util","theme_snap/appear"],(function($,log,templates,courseFavorites,mview,ajaxNotify,util,appear){return new function(){var self=this;this.applyCourseInfo=function(crsinfo){templates.render("theme_snap/course_cards",[]).done((function(){for(var i in crsinfo){var info=crsinfo[i];log.debug("applying course data for courseid "+info.course);var cardEl=$('.coursecard[data-courseid="'+info.course+'"]');mview(cardEl,"theme_snap/course_cards"),$(cardEl).trigger("modelUpdate",info)}}))},this.reqCourseInfo=function(courseids){if(0!==courseids.length){var courseiddata="courseids="+courseids.join(","),courseInfoKey=M.cfg.sesskey+"coursecard";log.debug("fetching course data"),$.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_courseinfo&contextid="+M.cfg.context,data:courseiddata,success:function(data){ajaxNotify.ifErrorShowBestMsg(data).done((function(errorShown){errorShown||(data.info?(log.debug("fetched coursedata",data.info),util.supportsSessionStorage()&&(window.sessionStorage[courseInfoKey]=JSON.stringify(data.info)),self.applyCourseInfo(data.info)):log.warn("fetched coursedata with error: JSON data object is missing info property",data))}))}})}},this.getCourseIds=function(){var courseIds=[];return $(".coursecard").each((function(){courseIds.push($(this).attr("data-courseid"))})),courseIds},this.applyAppearForImages=function(){appear(document.body).on("appear",".coursecard",(function(e,appeared){appeared.each((function(){var imgurl=$(this).data("image-url");if(void 0!==imgurl){var card=$(this);$('<img src="'+imgurl.trim()+'" />').on("load",(function(){$(card).css("background-image","url("+imgurl.trim()+")")}))}}))})),$("#snap-pm-courses .nav-tabs .nav-link").on("click",(function(){var selector=$(this).attr("href");$(selector)[0].addEventListener(function(){var t,el=document.createElement("fakeelement"),res="Animationend",animations={Animation:"Animationend",OAnimation:"oAnimationEnd",MozAnimation:"Animationend",WebkitAnimation:"webkitAnimationEnd"};for(t in animations)if(void 0!==el.style[t]){res=animations[t];break}return res}(),(function(){$.force_appear()}),!1)}));$(".coursecard").appear({appeartopoffset:100,appearleftoffset:100}),appear.force_appear()},this.init=function(){$(document).ready((function(){courseFavorites();var courseIds=self.getCourseIds(),courseInfoKey=M.cfg.sesskey+"coursecard";if(courseIds.length>0)if(self.applyAppearForImages(),util.supportsSessionStorage()&&window.sessionStorage[courseInfoKey]){var courseinfo=JSON.parse(window.sessionStorage[courseInfoKey]);self.applyCourseInfo(courseinfo)}else self.reqCourseInfo(courseIds)})),$(document).on("click",".coursecard[data-href]",(function(e){var trigger=$(e.target);$(trigger).closest("a").length||(window.open($(this).data("href"),"_self"),e.preventDefault())}))}}}));

//# sourceMappingURL=pm_course_cards.min.js.map