/**
 * This file is part of Moodle - http://moodle.org/
 *
 * Moodle is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Moodle is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @package
 * @copyright Copyright (c) 2015 Open LMS (https://www.openlms.net)
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_snap/cover_image",["jquery","core/log","core/ajax","core/notification","theme_snap/ajax_notification"],(function($,log,ajax,notification,ajaxNotify){var addCoverImageAlert=function(id,msg){var closestr=M.util.get_string("closebuttontitle","moodle");$(id).length||$("#snap-coverimagecontrol").before('<div id="'+id+'" class="snap-alert-cover-image alert alert-warning" role="alert">'+msg+'<button type="button" class="close" data-dismiss="alert" aria-label="'+closestr+'"><span aria-hidden="true">&times;</span></button></div>')},state1=function(){$("#snap-changecoverimageconfirmation .ok").removeClass("ajaxing"),$("#snap-alert-cover-image-size").remove(),$("#snap-alert-cover-image-bytes").remove(),$('label[for="snap-coverfiles"]').removeClass("ajaxing"),$("#snap-changecoverimageconfirmation").removeClass("state-visible"),$('label[for="snap-coverfiles"]').addClass("state-visible"),$("#snap-coverfiles").val("")},coverImage=function(siteMaxBytes,ajaxParams){var file,filedata;$("#page-header").data("servercoverfile",$("#page-header").css("background-image")),$("#changecoverimage").click((function(e){e.preventDefault(),$(this).removeClass("state-visible"),$('label[for="snap-coverfiles"]').addClass("state-visible")})),$("#snap-coverfiles").on("change",(function(e){$("body").addClass("cover-image-change");var files=e.target.files;if(files.length&&(file=files[0]).type.match("image.*")){var theFile,reader=new FileReader;$('label[for="snap-coverfiles"]').addClass("ajaxing"),reader.onload=(theFile=file,function(e){filedata=e.target.result,$(".path-course-view #page-header").addClass("mast-image"),$(".path-course-view #page-header .breadcrumb-item a").addClass("mast-breadcrumb");var maxbytes=siteMaxBytes;if(theFile.size>maxbytes){state1();var maxbytesstr=(size=maxbytes,i=Math.floor(Math.log(size)/Math.log(1024)),1*(size/Math.pow(1024,i)).toFixed(2)+" "+["B","kB","MB","GB","TB"][i]),message=M.util.get_string("error:coverimageexceedsmaxbytes","theme_snap",maxbytesstr);addCoverImageAlert("snap-alert-cover-image-bytes",message)}else{var size,i;$("#snap-alert-cover-image-bytes").remove();var img=$("<img />");(img=img.get(0)).src=filedata,$(img).on("load",(function(){img.width<1024?addCoverImageAlert("snap-alert-cover-image-size",M.util.get_string("error:coverimageresolutionlow","theme_snap")):$("#snap-alert-cover-image-size").remove()})),$("#page-header").css("background-image","url("+filedata+")"),$("#page-header").data("localcoverfile",theFile.name),$("#snap-alert-cover-image-upload-failed").remove(),$("#snap-changecoverimageconfirmation").removeClass("disabled"),$('label[for="snap-coverfiles"]').removeClass("state-visible"),$("#snap-changecoverimageconfirmation").addClass("state-visible"),$("body").removeClass("cover-image-change")}}),reader.readAsDataURL(file)}})),$("#snap-changecoverimageconfirmation .ok").click((function(){if(!$(this).parent().hasClass("disabled")){$("#snap-alert-cover-image-size").remove(),$("#snap-alert-cover-image-bytes").remove(),$("#snap-changecoverimageconfirmation .ok").addClass("ajaxing"),$("#snap-changecoverimageconfirmation").addClass("disabled");var imageData=filedata.split("base64,")[1];ajaxParams.imagedata=imageData,ajaxParams.imagefilename=file.name,ajax.call([{methodname:"theme_snap_cover_image",args:{params:ajaxParams},done:function(response){state1(),response.contrast&&addCoverImageAlert("snap-alert-cover-image-size",response.contrast),!response.success&&response.warning&&addCoverImageAlert("snap-alert-cover-image-upload-failed",response.warning)},fail:function(response){state1(),ajaxNotify.ifErrorShowBestMsg(response)}}],!0,!0)}})),$("#snap-changecoverimageconfirmation .cancel").click((function(){$(this).parent().hasClass("disabled")||($("#page-header").css("background-image",$("#page-header").data("servercoverfile")),state1())})),$("#snap-coverimagecontrol").addClass("snap-js-enabled")};return{courseImage:function(courseShortName,siteMaxBytes){coverImage(siteMaxBytes,{imagefilename:null,imagedata:null,categoryid:null,courseshortname:courseShortName})},categoryImage:function(categoryId,siteMaxBytes){coverImage(siteMaxBytes,{imagefilename:null,imagedata:null,categoryid:categoryId,courseshortname:null})}}}));

//# sourceMappingURL=cover_image.min.js.map